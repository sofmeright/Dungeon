apiVersion: apps/v1
kind: Deployment
metadata:
  name: erpnext-websocket
spec:
  replicas: 1
  selector:
    matchLabels:
      app: erpnext-websocket
  template:
    metadata:
      labels:
        app: erpnext-websocket
    spec:
      serviceAccountName: erpnext-websocket
      containers:
        - name: websocket
          image: PLACEHOLDER_ERPNEXT_IMAGE
          command:
            - node
            - /home/frappe/frappe-bench/apps/frappe/socketio.js
          ports:
            - containerPort: 9000
              name: websocket
          volumeMounts:
            - name: sites-data
              mountPath: /home/frappe/frappe-bench/sites
              readOnly: true
            - name: logs-data
              mountPath: /home/frappe/frappe-bench/logs
      volumes:
        - name: sites-data
          persistentVolumeClaim:
            claimName: PLACEHOLDER_SITES_PVC
        - name: logs-data
          persistentVolumeClaim:
            claimName: PLACEHOLDER_LOGS_PVC
