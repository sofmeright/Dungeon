apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: mealie-app-secrets
  namespace: the-lost-woods
spec:
  refreshInterval: 5m
  secretStoreRef:
    name: vault-backend
    kind: ClusterSecretStore
  target:
    name: mealie-app-secrets
    template:
      type: Opaque
      data:
        postgres_user: "{{ .postgres_user | toString }}"
        postgres_password: "{{ .postgres_password | toString }}"
        oidc_client_id: "{{ .oidc_client_id | toString }}"
        oidc_client_secret: "{{ .oidc_client_secret | toString }}"
  dataFrom:
    - extract:
        key: apps/mealie
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: mealie-smtp-secrets
  namespace: the-lost-woods
spec:
  refreshInterval: 5m
  secretStoreRef:
    name: vault-backend
    kind: ClusterSecretStore
  target:
    name: mealie-smtp-secrets
    template:
      type: Opaque
      data:
        smtp_email: "{{ .email | toString }}"
        smtp_password: "{{ .password | toString }}"
        smtp_name: "{{ .name | toString }}"
  dataFrom:
    - extract:
        key: smtp/ofcourseimvegan