apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: ark-sa-tmc
spec:
  serviceName: ark-sa-tmc
  replicas: 1
  selector:
    matchLabels:
      app: ark-sa-tmc
  template:
    metadata:
      labels:
        app: ark-sa-tmc
    spec:
      enableServiceLinks: false
      initContainers:
      - name: fix-serverfiles-permissions
        image: docker.io/library/busybox:latest
        command:
        - sh
        - -c
        - chown -R 7777:7777 /home/pok/arkserver && chmod -R 755 /home/pok/arkserver
        volumeMounts:
        - name: serverfiles
          mountPath: /home/pok/arkserver
      - name: fix-cluster-permissions
        image: docker.io/library/busybox:latest
        command:
        - sh
        - -c
        - chown -R 7777:7777 /clusters && chmod -R 755 /clusters
        volumeMounts:
        - name: cluster
          mountPath: /clusters
      containers: []
      # Containers will be added via overlay patches for each map
  volumeClaimTemplates:
  - metadata:
      name: serverfiles
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 100Gi
  - metadata:
      name: cluster
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
