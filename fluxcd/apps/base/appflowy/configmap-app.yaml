apiVersion: v1
kind: ConfigMap
metadata:
  name: appflowy-app-config
  labels:
    app: appflowy
data:
  # Logging configuration
  RUST_LOG: "info"

  # Admin Frontend URLs (internal cluster DNS)
  ADMIN_FRONTEND_REDIS_URL: "redis://appflowy-redis:6379"
  ADMIN_FRONTEND_GOTRUE_URL: "http://appflowy-gotrue:9999"
  ADMIN_FRONTEND_APPFLOWY_CLOUD_URL: "http://appflowy-cloud:8000"
  ADMIN_FRONTEND_PATH_PREFIX: "/admin"

  # AI Service Configuration
  AI_SERVER_PORT: "5001"
  AI_REDIS_URL: "redis://appflowy-redis:6379"

  # Worker Configuration
  APPFLOWY_WORKER_REDIS_URL: "redis://appflowy-redis:6379"

  # S3/MinIO Configuration
  APPFLOWY_S3_USE_MINIO: "true"
  APPFLOWY_S3_MINIO_URL: "http://appflowy-minio:9000"
  APPFLOWY_S3_BUCKET: "appflowy"
  APPFLOWY_S3_REGION: "us-east-1"

  # SMTP Configuration (non-sensitive)
  APPFLOWY_MAILER_SMTP_HOST: "smtp.gmail.com"
  APPFLOWY_MAILER_SMTP_PORT: "587"
  APPFLOWY_MAILER_SMTP_TLS_KIND: "starttls"

  # GoTrue SMTP Configuration
  GOTRUE_SMTP_HOST: "smtp.gmail.com"
  GOTRUE_SMTP_PORT: "587"
  GOTRUE_SMTP_MAX_FREQUENCY: "1ns"

  # GoTrue JWT Configuration
  GOTRUE_JWT_EXP: "7200"
  APPFLOWY_GOTRUE_JWT_EXP: "7200"
  GOTRUE_MAILER_AUTOCONFIRM: "true"
  GOTRUE_RATE_LIMIT_EMAIL_SENT: "100"
  GOTRUE_DISABLE_SIGNUP: "false"

  # OAuth Configuration (disabled)
  GOTRUE_EXTERNAL_GOOGLE_ENABLED: "false"
  GOTRUE_EXTERNAL_GITHUB_ENABLED: "false"
  GOTRUE_EXTERNAL_DISCORD_ENABLED: "false"

  # AI Service Configuration
  AI_SERVER_HOST: "appflowy-ai"
  AI_SERVER_PORT: "5001"
  APPFLOWY_AI_SERVER_PORT: "5001"
  AI_REDIS_URL: "redis://appflowy-redis:6379"
  APPFLOWY_AI_REDIS_URL: "redis://appflowy-redis:6379"

  # Worker Configuration
  APPFLOWY_WORKER_ENVIRONMENT: "production"
  APPFLOWY_WORKER_IMPORT_TICK_INTERVAL: "30"
  APPFLOWY_ENVIRONMENT: "production"

  # AppFlowy Cloud Configuration
  APPFLOWY_ACCESS_CONTROL: "true"
  APPFLOWY_WEBSOCKET_MAILBOX_SIZE: "6000"
  APPFLOWY_DATABASE_MAX_CONNECTIONS: "40"

  # Indexer Configuration
  APPFLOWY_INDEXER_ENABLED: "true"
  APPFLOWY_INDEXER_REDIS_URL: "redis://appflowy-redis:6379"
  APPFLOWY_INDEXER_EMBEDDING_BUFFER_SIZE: "5000"

  # Collaborate Configuration
  APPFLOWY_COLLABORATE_MULTI_THREAD: "false"
  APPFLOWY_COLLABORATE_REMOVE_BATCH_SIZE: "100"

  # AppFlowy Cloud Configuration (internal cluster DNS)
  APPFLOWY_BASE_URL: "http://appflowy-cloud:8000"
  APPFLOWY_GOTRUE_BASE_URL: "http://appflowy-gotrue:9999"

  # External URLs (patched by overlay for each environment)
  APPFLOWY_WS_BASE_URL: "PLACEHOLDER_EXTERNAL_WS_URL"
  API_EXTERNAL_URL: "PLACEHOLDER_EXTERNAL_API_URL"
