apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: libretranslate
spec:
  template:
    spec:
      securityContext:
        runAsUser: 1032
        runAsGroup: 1032
        fsGroup: 1032
      runtimeClassName: nvidia
      containers:
        - name: libretranslate
          env:
            - name: HOME
              value: /home/libretranslate
            - name: LT_API_KEYS_DB_PATH
              value: /home/libretranslate/.local/api_keys.db
          volumeMounts:
            - name: models
              mountPath: /home/libretranslate/.local
  volumeClaimTemplates:
    - metadata:
        name: models
        labels:
          app: libretranslate
          volume-type: models
      spec:
        storageClassName: ceph-rbd
        accessModes:
          - ReadWriteOnce
        resources:
          requests:
            storage: 20Gi
