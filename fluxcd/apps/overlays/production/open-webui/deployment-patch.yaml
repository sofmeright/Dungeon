apiVersion: apps/v1
kind: Deployment
metadata:
  name: open-webui
spec:
  replicas: 3
  template:
    spec:
      containers:
      - name: open-webui
        image: ghcr.io/open-webui/open-webui:latest
        env:
        - name: DATABASE_URL
          value: "postgresql+asyncpg://openwebui:$(POSTGRES_PASSWORD)@open-webui-postgres-rw.temple-of-time.svc.cluster.local:5432/openwebui"
        - name: REDIS_URL
          value: "redis://:$(REDIS_PASSWORD)@open-webui-sentinel.temple-of-time.svc.cluster.local:26379/0?sentinel=open-webui-redis&sentinel_fallback=open-webui-sentinel-0.open-webui-sentinel-headless.temple-of-time.svc.cluster.local:26379,open-webui-sentinel-1.open-webui-sentinel-headless.temple-of-time.svc.cluster.local:26379,open-webui-sentinel-2.open-webui-sentinel-headless.temple-of-time.svc.cluster.local:26379"
        - name: WEBSOCKET_REDIS_URL
          value: "redis://:$(REDIS_PASSWORD)@open-webui-sentinel.temple-of-time.svc.cluster.local:26379/0?sentinel=open-webui-redis&sentinel_fallback=open-webui-sentinel-0.open-webui-sentinel-headless.temple-of-time.svc.cluster.local:26379,open-webui-sentinel-1.open-webui-sentinel-headless.temple-of-time.svc.cluster.local:26379,open-webui-sentinel-2.open-webui-sentinel-headless.temple-of-time.svc.cluster.local:26379"
        - name: OLLAMA_BASE_URLS
          value: "http://172.22.22.143:11434,http://172.22.22.144:11434"
        - name: OPENID_PROVIDER_URL
          value: "https://sso.prplanit.com/.well-known/openid-configuration"
        resources:
          requests:
            cpu: "200m"
            memory: "512Mi"
          limits:
            cpu: "1000m"
            memory: "2Gi"
