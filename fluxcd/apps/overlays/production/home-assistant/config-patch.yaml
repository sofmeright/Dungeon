apiVersion: v1
kind: ConfigMap
metadata:
  name: home-assistant-config
data:
  configuration.yaml: |
    # Loads default set of integrations. Do not remove.
    default_config:

    # Load frontend themes from the themes folder
    frontend:
      themes: !include_dir_merge_named themes

    automation: !include automations.yaml
    script: !include scripts.yaml
    scene: !include scenes.yaml

    http:
      use_x_forwarded_for: true
      trusted_proxies:
        - 192.168.144.0/20  # Cluster pod CIDR (gateway/proxy pods)
        - 172.22.30.70      # phloem-gateway LoadBalancer IP
        - 172.22.144.0/24   # Node network

    # Google Assistant integration
    google_assistant:
      project_id: hass-arbitorium-com
      service_account: !include SERVICE_ACCOUNT.JSON
      report_state: true
      exposed_domains:
        - switch
        - light
      entity_config:
        lock.0x002446fffd08ea2f:
          name: Front Door (Inner) Lock
          expose: false
        lock.0x002446fffd08d4ec:
          name: Front Door (Outer) Lock
          expose: false
  service-account-template.json: |
    {
      "type": "service_account",
      "project_id": "hass-arbitorium-com",
      "private_key_id": "PLACEHOLDER",
      "private_key": "PLACEHOLDER",
      "client_email": "hassio@hass-arbitorium-com.iam.gserviceaccount.com",
      "client_id": "PLACEHOLDER",
      "auth_uri": "https://accounts.google.com/o/oauth2/auth",
      "token_uri": "https://oauth2.googleapis.com/token",
      "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
      "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/hassio%40hass-arbitorium-com.iam.gserviceaccount.com",
      "universe_domain": "googleapis.com"
    }
