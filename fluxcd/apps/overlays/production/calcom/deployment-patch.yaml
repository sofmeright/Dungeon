apiVersion: apps/v1
kind: Deployment
metadata:
  name: calcom
spec:
  replicas: 3
  template:
    metadata:
      labels:
        policy.prplanit.com/ingress: "true"
    spec:
      securityContext:
        runAsUser: 1001
        runAsGroup: 1001
        fsGroup: 1001
      initContainers:
        - name: fix-yarn-perms
          image: docker.io/calcom/cal.com:v6.1.16
          securityContext:
            runAsUser: 0
          command:
            - sh
            - -c
            - |
              cp -a /calcom/.yarn/* /yarn-writable/
              chown -R 1001:1001 /yarn-writable/
          volumeMounts:
            - name: yarn-dir
              mountPath: /yarn-writable
      containers:
        - name: calcom
          image: docker.io/calcom/cal.com:v6.1.16
          env:
            - name: NEXT_PUBLIC_WEBAPP_URL
              value: https://cal.prplanit.com
            - name: NEXT_PUBLIC_API_V2_URL
              value: https://cal.prplanit.com/api/v2
            - name: NEXTAUTH_URL
              value: https://cal.prplanit.com
          volumeMounts:
            - name: yarn-dir
              mountPath: /calcom/.yarn
            - name: turbo-dir
              mountPath: /calcom/.turbo
      volumes:
        - name: yarn-dir
          emptyDir: {}
        - name: turbo-dir
          emptyDir: {}
