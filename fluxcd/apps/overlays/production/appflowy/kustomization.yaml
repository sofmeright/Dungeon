apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: temple-of-time
resources:
  - ../../../base/appflowy
  - httproute.yaml
  - httproute-xylem.yaml
  - externalsecret-s3.yaml
  - secret-postgres-init.yaml
patches:
  - path: postgres-cluster-patch.yaml
  - path: statefulset-redis-patch.yaml
  - path: deployment-gotrue-patch.yaml
  - path: deployment-appflowy-cloud-patch.yaml
  - path: deployment-appflowy-cloud-env-patch.yaml
  - path: deployment-admin-frontend-patch.yaml
  - path: deployment-ai-patch.yaml
  - path: deployment-worker-patch.yaml
  - path: deployment-web-patch.yaml
  - path: deployment-nginx-patch.yaml
  - path: service-nginx-patch.yaml
  - path: externalsecret-postgres-app-patch.yaml
  - path: externalsecret-shared-patch.yaml
  - path: externalsecret-cloud-patch.yaml
  - path: externalsecret-gotrue-patch.yaml
  - path: externalsecret-worker-patch.yaml
  - path: externalsecret-ai-patch.yaml
  # Skip postgres-init ExternalSecret - using plain Secret instead (no secrets needed)
  - path: configmap-app-patch.yaml
  - path: configmap-nginx-patch.yaml
  # Delete the base ExternalSecret since we're using a plain Secret
  - patch: |-
      $patch: delete
      apiVersion: external-secrets.io/v1beta1
      kind: ExternalSecret
      metadata:
        name: appflowy-postgres-init-sql
