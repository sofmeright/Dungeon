apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: homarr
spec:
  template:
    spec:
      containers:
      - name: homarr
        volumeMounts:
        - name: lost-woods-homarr-sqlite
          mountPath: /appdata/db
        - name: lost-woods-homarr-images
          mountPath: /images
        env:
        - name: DATABASE_URL
          value: "file:/appdata/db/homarr.db"
        - name: NEXTAUTH_URL
          value: "http://172.22.30.223:7575"
        - name: AUTH_PROVIDERS
          value: "credentials,oidc"
        - name: AUTH_LOGOUT_REDIRECT_URL
          value: "https://apptray.pcfae.com"
        - name: AUTH_SESSION_EXPIRY_TIME
          value: "30d"
        - name: AUTH_OIDC_ISSUER
          value: "https://sso.prplanit.com"
        - name: AUTH_OIDC_CLIENT_NAME
          value: "PrecisionPlanIT.com SSO"
        - name: AUTH_OIDC_AUTO_LOGIN
          value: "false"
        - name: AUTH_OIDC_SCOPE_OVERWRITE
          value: "openid email profile groups"
        - name: AUTH_OIDC_GROUPS_ATTRIBUTE
          value: "roles"
        - name: AUTH_OIDC_NAME_ATTRIBUTE_OVERWRITE
          value: "email"
        - name: AUTH_OIDC_FORCE_USERINFO
          value: "false"
  volumeClaimTemplates:
  - metadata:
      name: lost-woods-homarr-sqlite
    spec:
      accessModes:
      - ReadWriteOnce
      storageClassName: ceph-rbd-retain
      resources:
        requests:
          storage: 100Mi
  - metadata:
      name: lost-woods-homarr-images
    spec:
      accessModes:
      - ReadWriteOnce
      storageClassName: ceph-rbd-retain
      resources:
        requests:
          storage: 2Gi
