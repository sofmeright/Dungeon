apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: temple-of-time

resources:
  - ../../../base/plex

patches:
  - path: service-patch.yaml
    target:
      kind: Service
      name: plex
  - path: statefulset-patch.yaml
    target:
      kind: StatefulSet
      name: plex
  - path: storage-patch.yaml
  - target:
      kind: PersistentVolume
      name: plex-media-movies
    patch: |-
      - op: add
        path: /spec/csi/nodeStageSecretRef/namespace
        value: temple-of-time
  - target:
      kind: PersistentVolume
      name: plex-media-tv
    patch: |-
      - op: add
        path: /spec/csi/nodeStageSecretRef/namespace
        value: temple-of-time
  - target:
      kind: PersistentVolume
      name: plex-media-music
    patch: |-
      - op: add
        path: /spec/csi/nodeStageSecretRef/namespace
        value: temple-of-time
  - target:
      kind: PersistentVolume
      name: plex-media-photos
    patch: |-
      - op: add
        path: /spec/csi/nodeStageSecretRef/namespace
        value: temple-of-time