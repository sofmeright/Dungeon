# Frigate StatefulSet production overlay
# - Pinned image version
# - frigate-notify sidecar for ntfy alerts
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: frigate
spec:
  replicas: 1
  template:
    spec:
      containers:
        # Main Frigate container
        - name: frigate
          image: ghcr.io/blakeblackshear/frigate:0.16.4-tensorrt
        # Notification sidecar - polls Frigate API, sends to ntfy
        - name: frigate-notify
          image: ghcr.io/0x2142/frigate-notify:v0.5.4
          env:
            - name: FN_NTFY_TOKEN
              valueFrom:
                secretKeyRef:
                  name: frigate-secret
                  key: NTFY_TOKEN
          volumeMounts:
            - name: frigate-notify-config
              mountPath: /app/config.yml
              subPath: config.yml
          resources:
            requests:
              cpu: 10m
              memory: 32Mi
            limits:
              cpu: 100m
              memory: 64Mi
      volumes:
        - name: frigate-notify-config
          configMap:
            name: frigate-notify-config
