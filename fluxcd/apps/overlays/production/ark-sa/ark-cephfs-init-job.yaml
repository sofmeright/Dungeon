apiVersion: batch/v1
kind: Job
metadata:
  name: ark-sa-tmc-cephfs-init
spec:
  ttlSecondsAfterFinished: 300
  template:
    spec:
      restartPolicy: OnFailure
      containers:
      - name: init
        image: docker.io/alpine:latest
        command:
        - /bin/sh
        - -c
        - |
          set -e
          echo "Setting permissions on serverfiles (UID/GID 1001)..."
          chown 1001:1001 /serverfiles
          chmod 755 /serverfiles

          echo "Setting permissions on cluster (UID/GID 1001)..."
          chown 1001:1001 /cluster
          chmod 755 /cluster

          echo "Verifying structure..."
          ls -la /serverfiles
          ls -la /cluster

          echo "ARK CephFS initialization complete!"
        volumeMounts:
        - name: serverfiles
          mountPath: /serverfiles
        - name: cluster
          mountPath: /cluster
      volumes:
      - name: serverfiles
        persistentVolumeClaim:
          claimName: ark-sa-serverfiles-pvc
      - name: cluster
        persistentVolumeClaim:
          claimName: ark-sa-cluster-pvc
