---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: cephfs-root-temp
spec:
  capacity:
    storage: 1Gi
  accessModes:
    - ReadWriteMany
  persistentVolumeReclaimPolicy: Retain
  csi:
    driver: gorons-bracelet.cephfs.csi.ceph.com
    nodeStageSecretRef:
      name: csi-cephfs-node
      namespace: gorons-bracelet
    volumeAttributes:
      clusterID: 0985467c-d8f3-4483-b27f-f0a512397ec2
      fsName: Seed_Bank
      staticVolume: "true"
      rootPath: /
    volumeHandle: cephfs-root-temp
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: cephfs-root-temp-pvc
spec:
  accessModes:
    - ReadWriteMany
  resources:
    requests:
      storage: 1Gi
  volumeName: cephfs-root-temp
  storageClassName: ""
---
apiVersion: batch/v1
kind: Job
metadata:
  name: ark-sa-cephfs-mkdir
spec:
  ttlSecondsAfterFinished: 300
  template:
    spec:
      restartPolicy: OnFailure
      containers:
      - name: mkdir
        image: docker.io/alpine:latest
        command:
        - /bin/sh
        - -c
        - |
          set -e
          echo "Creating directory structure in CephFS..."
          mkdir -p /cephfs/dungeon/nvme/games/ark-sa/serverfiles
          mkdir -p /cephfs/dungeon/nvme/games/ark-sa/cluster

          echo "Setting ownership to UID/GID 1001..."
          chown -R 1001:1001 /cephfs/dungeon/nvme/games/ark-sa

          echo "Setting permissions..."
          chmod -R 755 /cephfs/dungeon/nvme/games/ark-sa

          echo "Verifying structure..."
          ls -la /cephfs/dungeon/nvme/games/ark-sa/

          echo "CephFS directory structure created successfully!"
        volumeMounts:
        - name: cephfs-root
          mountPath: /cephfs
      volumes:
      - name: cephfs-root
        persistentVolumeClaim:
          claimName: cephfs-root-temp-pvc
