apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: gitlab-s3-storage
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: vault-operationtimecapsule
    kind: ClusterSecretStore
  target:
    name: gitlab-s3-storage
    creationPolicy: Owner
    template:
      data:
        connection: |
          provider: AWS
          region: us-east-1
          aws_access_key_id: {{ .access_key }}
          aws_secret_access_key: {{ .secret_key }}
          host: ceph-rgw.gorons-bracelet.svc.cluster.local
          endpoint: http://ceph-rgw.gorons-bracelet.svc.cluster.local
          path_style: true
  data:
  - secretKey: access_key
    remoteRef:
      key: apps/gitlab
      property: s3_access_key
  - secretKey: secret_key
    remoteRef:
      key: apps/gitlab
      property: s3_secret_key
