apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: code-server
spec:
  template:
    spec:
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
              - matchExpressions:
                  - key: kubernetes.io/hostname
                    operator: In
                    values:
                      - dungeon-map-002
      tolerations:
        - key: node-role.kubernetes.io/control-plane
          operator: Exists
          effect: NoSchedule
      containers:
        - name: code-server
          image: lscr.io/linuxserver/code-server:latest
          env:
            - name: PROXY_DOMAIN
              value: "code.pcfae.com"
          volumeMounts:
            - name: tingle-tuner-code-server-config
              mountPath: /config
            - name: srv
              mountPath: /srv
          resources:
            requests:
              cpu: "2m"
              memory: "20Mi"
            limits:
              cpu: "50m"
              memory: "24Mi"
      volumes:
        - name: srv
          hostPath:
            path: /srv
            type: Directory
        - name: tingle-tuner-code-server-config
          hostPath:
            path: /opt/k8s-data/code-server/config
            type: DirectoryOrCreate
