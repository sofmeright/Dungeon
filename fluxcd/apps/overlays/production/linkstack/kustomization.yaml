apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: kokiri-forest
configMapGenerator:
  - name: linkstack-apache-config
    files:
      - httpd.conf
      - ssl.conf
resources:
  - ../../../base/linkstack
  - httproute-xylem.yaml
patches:
  - path: statefulset-patch.yaml
    target:
      kind: StatefulSet
      name: linkstack
  # Replace imagePullSecrets instead of merging (removes placeholder)
  - target:
      kind: StatefulSet
      name: linkstack
    patch: |
      - op: replace
        path: /spec/template/spec/imagePullSecrets
        value:
          - name: jcr-pcfae-dungeon-pull-secret
  - path: statefulset-db-patch.yaml
    target:
      kind: StatefulSet
      name: linkstack-db
  - path: service-patch.yaml
    target:
      kind: Service
      name: linkstack
  - path: httproute-patch.yaml
    target:
      kind: HTTPRoute
      name: linkstack
  - path: service-linkstack-ingress-patch.yaml
    target:
      kind: Service
      name: linkstack
