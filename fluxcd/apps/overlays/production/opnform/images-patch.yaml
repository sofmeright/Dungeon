apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: opnform-postgres
spec:
  template:
    spec:
      containers:
        - name: postgres
          image: docker.io/postgres:16
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: opnform-redis
spec:
  template:
    spec:
      containers:
        - name: redis
          image: docker.io/redis:7
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: opnform-api
spec:
  template:
    spec:
      initContainers:
        - name: wait-for-db
          image: docker.io/busybox:latest
        - name: wait-for-redis
          image: docker.io/busybox:latest
      containers:
        - name: api
          image: docker.io/jhumanj/opnform-api:latest
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: opnform-api-worker
spec:
  template:
    spec:
      containers:
        - name: worker
          image: docker.io/jhumanj/opnform-api:latest
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: opnform-api-scheduler
spec:
  template:
    spec:
      containers:
        - name: scheduler
          image: docker.io/jhumanj/opnform-api:latest
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: opnform-client
spec:
  template:
    spec:
      containers:
        - name: client
          image: docker.io/jhumanj/opnform-client:latest
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: opnform-ingress
spec:
  template:
    spec:
      containers:
        - name: nginx
          image: docker.io/nginx:1
