---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mealie
spec:
  replicas: 1
  template:
    spec:
      containers:
      - name: mealie
        image: ghcr.io/mealie-recipes/mealie:nightly
        env:
        - name: BASE_URL
          value: "https://mealie.yesimvegan.com"
        - name: OIDC_PROVIDER_NAME
          value: "PrPlanIT.com"
        - name: OIDC_CONFIGURATION_URL
          value: "https://sso.prplanit.com/.well-known/openid-configuration"
        volumeMounts:
        - name: temple-of-time-mealie-data
          mountPath: /app/data
  volumeClaimTemplates:
  - metadata:
      name: temple-of-time-mealie-data
    spec:
      accessModes:
        - ReadWriteOnce
      storageClassName: ceph-rbd-retain
      resources:
        requests:
          storage: 10Gi
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mealie-postgres
spec:
  replicas: 1
  template:
    spec:
      containers:
      - name: postgres
        image: docker.io/library/postgres:15
        volumeMounts:
        - name: temple-of-time-mealie-postgres
          mountPath: /var/lib/postgresql/data
  volumeClaimTemplates:
  - metadata:
      name: temple-of-time-mealie-postgres
    spec:
      accessModes:
        - ReadWriteOnce
      storageClassName: ceph-rbd-retain
      resources:
        requests:
          storage: 20Gi