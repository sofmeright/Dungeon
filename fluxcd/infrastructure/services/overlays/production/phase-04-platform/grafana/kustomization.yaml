apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - ../../../../base/grafana
  - cephfs-plugins-pv.yaml
  - httproute-xylem.yaml
  - externalsecret-ntfy.yaml

patches:
  - path: helmrelease-patch.yaml
    target:
      kind: HelmRelease
      name: grafana
  - path: postgres-cluster-patch.yaml
    target:
      kind: Cluster
      name: grafana-postgres
  - path: externalsecret-postgres-patch.yaml
    target:
      kind: ExternalSecret
      name: grafana-postgres-credentials
  - target:
      kind: HelmRelease
      name: grafana
    patch: |-
      - op: add
        path: /metadata/namespace
        value: flux-system
  - target:
      kind: HelmRepository
      name: grafana
    patch: |-
      - op: add
        path: /metadata/namespace
        value: flux-system
  - target:
      kind: Cluster
      name: grafana-postgres
    patch: |-
      - op: add
        path: /metadata/namespace
        value: gossip-stone
  - target:
      kind: ExternalSecret
      name: grafana-postgres-credentials
    patch: |-
      - op: add
        path: /metadata/namespace
        value: gossip-stone
  - target:
      kind: PersistentVolumeClaim
      name: gossip-stone-grafana-plugins
    patch: |-
      - op: add
        path: /metadata/namespace
        value: gossip-stone
  - target:
      kind: HTTPRoute
      name: grafana-xylem
    patch: |-
      - op: add
        path: /metadata/namespace
        value: gossip-stone
  - target:
      kind: ConfigMap
      name: grafana-dashboards
    patch: |-
      - op: add
        path: /metadata/namespace
        value: gossip-stone
  - target:
      kind: ExternalSecret
      name: grafana-ntfy-token
    patch: |-
      - op: add
        path: /metadata/namespace
        value: gossip-stone
