apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: ntfy
spec:
  replicas: 1
  template:
    spec:
      imagePullSecrets:
        - name: jcr-pcfae-dungeon-pull-secret
      containers:
        - name: ntfy
          image: docker.io/binwiederhier/ntfy:v2.11.0
          ports:
            - name: http
              containerPort: 80
              protocol: TCP
            - name: smtp
              containerPort: 25
              protocol: TCP
          env:
            - name: NTFY_BASE_URL
              value: "https://ntfy.prplanit.com"
            - name: NTFY_BEHIND_PROXY
              value: "true"
            - name: NTFY_CACHE_DURATION
              value: "365d"
            - name: NTFY_SMTP_SERVER_LISTEN
              value: ":25"
            - name: NTFY_SMTP_SERVER_DOMAIN
              value: "m.ntfy.prplanit.com"
            - name: NTFY_SMTP_SERVER_ADDR_PREFIX
              value: "ntfy-"
          volumeMounts:
            - name: delivery-bag-ntfy-data
              mountPath: /var/lib/ntfy
          resources:
            requests:
              cpu: 50m
              memory: 512Mi
            limits:
              cpu: 500m
              memory: 1536Mi
  volumeClaimTemplates:
    - metadata:
        name: delivery-bag-ntfy-data
      spec:
        accessModes: ["ReadWriteOnce"]
        storageClassName: ceph-rbd-retain
        resources:
          requests:
            storage: 5Gi
