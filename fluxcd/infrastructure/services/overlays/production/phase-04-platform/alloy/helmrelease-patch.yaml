apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: alloy
spec:
  targetNamespace: gossip-stone
  values:
    alloy:
      extraAnnotations:
        prometheus.io/scrape: "true"
        prometheus.io/port: "12345"
      configMap:
        create: false
        name: "alloy-config"
      resources:
        requests:
          cpu: 1000m
          memory: 6Gi
        limits:
          cpu: "3"
          memory: 10Gi
  postRenderers:
    - kustomize:
        patches:
          - target:
              kind: DaemonSet
              name: alloy
            patch: |-
              apiVersion: apps/v1
              kind: DaemonSet
              metadata:
                name: alloy
              spec:
                template:
                  spec:
                    hostNetwork: true
                    dnsPolicy: ClusterFirstWithHostNet
