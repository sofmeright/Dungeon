apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: gitlab-smtp-oidc
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: PLACEHOLDER_VAULT_CLUSTER_SECRET_STORE
  target:
    name: gitlab-smtp-oidc
    creationPolicy: Owner
    template:
      type: Opaque
      data:
        smtp_password: "{{ .smtp_password }}"
        smtp_address: "{{ .smtp_address }}"
        smtp_port: "{{ .smtp_port }}"
        smtp_username: "{{ .smtp_username }}"
        smtp_domain: "{{ .smtp_domain }}"
        smtp_authentication: "{{ .smtp_authentication }}"
        gitlab_email_from: "{{ .gitlab_email_from }}"
        gitlab_email_reply_to: "{{ .gmail_email_reply_to }}"
        oidc_client_id: "{{ .oidc_client_id }}"
        oidc_client_secret: "{{ .oidc_client_secret }}"
        oidc_issuer: "{{ .oidc_issuer }}"
        oidc_redirect_uri: "{{ .oidc_redirect_uri }}"
  data:
  - secretKey: smtp_address
    remoteRef:
      key: apps/gitlab
      property: smtp-address
  - secretKey: smtp_port
    remoteRef:
      key: apps/gitlab
      property: smtp-port
  - secretKey: smtp_username
    remoteRef:
      key: apps/gitlab
      property: smtp-username
  - secretKey: smtp_password
    remoteRef:
      key: apps/gitlab
      property: smtp-password
  - secretKey: smtp_domain
    remoteRef:
      key: apps/gitlab
      property: smtp-domain
  - secretKey: smtp_authentication
    remoteRef:
      key: apps/gitlab
      property: smtp-authentication
  - secretKey: gitlab_email_from
    remoteRef:
      key: apps/gitlab
      property: gitlab-email-from
  - secretKey: gitlab_email_reply_to
    remoteRef:
      key: apps/gitlab
      property: gitlab-email-reply-to
  - secretKey: oidc_client_id
    remoteRef:
      key: apps/gitlab
      property: oidc-client-id
  - secretKey: oidc_client_secret
    remoteRef:
      key: apps/gitlab
      property: oidc-client-secret
  - secretKey: oidc_issuer
    remoteRef:
      key: apps/gitlab
      property: oidc-issuer
  - secretKey: oidc_redirect_uri
    remoteRef:
      key: apps/gitlab
      property: oidc-redirect-uri
