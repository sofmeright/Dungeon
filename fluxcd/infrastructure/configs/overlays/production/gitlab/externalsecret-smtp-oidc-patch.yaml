apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: gitlab-smtp-oidc
spec:
  secretStoreRef:
    name: vault-precisionplanit
  target:
    template:
      data:
        provider: |
          name: 'openid_connect'
          label: 'PrecisionPlanIT.com'
          icon: 'https://sso.prplanit.com/ui/console/assets/icons/favicon-32x32.png'
          args:
            name: 'openid_connect'
            scope: ['openid', 'profile', 'email']
            response_type: 'code'
            issuer: '{{ .oidc_issuer }}'
            discovery: true
            client_auth_method: 'query'
            uid_field: 'sub'
            client_options:
              identifier: '{{ .oidc_client_id }}'
              secret: '{{ .oidc_client_secret }}'
              redirect_uri: '{{ .oidc_redirect_uri }}'
