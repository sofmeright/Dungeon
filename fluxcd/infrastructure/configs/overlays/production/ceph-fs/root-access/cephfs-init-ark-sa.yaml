---
apiVersion: batch/v1
kind: Job
metadata:
  name: cephfs-init-ark-sa
spec:
  ttlSecondsAfterFinished: 300
  template:
    spec:
      restartPolicy: OnFailure
      initContainers:
        - name: setup-nvme
          image: docker.io/prplanit/ansible-oci:2.20.1-v2
          command:
            - ansible-playbook
            - /scripts/cephfs-init-rootpaths.yml
            - -e
            - path=/dungeon/nvme/games/ark-sa/serverfiles owner=7777:7777 mode=0755
          volumeMounts:
            - name: cephfs-root
              mountPath: /cephfs
            - name: setup-script
              mountPath: /scripts
              readOnly: true
      containers:
        - name: setup-hdd
          image: docker.io/prplanit/ansible-oci:2.20.1-v2
          command:
            - ansible-playbook
            - /scripts/cephfs-init-rootpaths.yml
            - -e
            - path=/dungeon/hdd/games/ark-sa subdirs=cluster,steamapps owner=7777:7777 mode=0755
          volumeMounts:
            - name: cephfs-root
              mountPath: /cephfs
            - name: setup-script
              mountPath: /scripts
              readOnly: true
      volumes:
        - name: cephfs-root
          persistentVolumeClaim:
            claimName: gorons-bracelet-cephfs-root
        - name: setup-script
          configMap:
            name: cephfs-setup-script
