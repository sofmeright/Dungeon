---
apiVersion: batch/v1
kind: Job
metadata:
  name: cephfs-init-mimir
spec:
  ttlSecondsAfterFinished: 300
  template:
    spec:
      restartPolicy: OnFailure
      containers:
        - name: setup
          image: docker.io/prplanit/ansible-oci:2.20.1-v2
          command:
            - ansible-playbook
            - /scripts/cephfs-init-rootpaths.yml
            - -e
            - path=/dungeon/nvme/apps/mimir subdirs=ingester-0,ingester-1,ingester-2,store-gateway-0,compactor-0,alertmanager-0 owner=10001:10001 mode=0755
          volumeMounts:
            - name: cephfs-root
              mountPath: /cephfs
            - name: setup-script
              mountPath: /scripts
              readOnly: true
      volumes:
        - name: cephfs-root
          persistentVolumeClaim:
            claimName: gorons-bracelet-cephfs-root
        - name: setup-script
          configMap:
            name: cephfs-setup-script
