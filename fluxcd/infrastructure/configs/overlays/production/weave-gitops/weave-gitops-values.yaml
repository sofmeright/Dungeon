# Configuration values for Weave GitOps HelmRelease
apiVersion: v1
kind: ConfigMap
metadata:
  name: weave-gitops-values
  namespace: flux-system
data:
  values.yaml: |
    # Admin user configuration
    adminUser:
      create: false  # Disable admin user completely
    
    # Use user-account auth method with external secret
    additionalArgs:
      - --auth-methods=user-account
    
    # RBAC configuration - simplified since we handle permissions in rbac.yaml
    rbac:
      create: true
      viewSecretsResourceNames: ["cluster-user-auth", "oidc-auth"]
      # No impersonation needed - ServiceAccount has direct permissions via rbac.yaml
    
    # Additional security settings
    metrics:
      enabled: true
    
    # Service configuration - use LoadBalancer with MetalLB
    service:
      type: LoadBalancer
      annotations:
        metallb.universe.tf/loadBalancerIPs: "172.22.30.100"
        metallb.universe.tf/allow-shared-ip: "weave-gitops"
      port: 9001
    
    # Disable ingress since we're using LoadBalancer
    ingress:
      enabled: false