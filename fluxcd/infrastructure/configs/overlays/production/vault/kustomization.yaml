apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: zeldas-lullaby

resources:
  - ../../../base/vault           # Vault CR base
  - vault-unseal-keys.enc.yaml    # SOPS-encrypted unseal keys (reinitialized 2025-09-26)
  - vault-oidc-credentials.enc.yaml  # SOPS-encrypted OIDC client secret for Zitadel SSO
  - external-secrets-sa.yaml      # ServiceAccount for External Secrets Kubernetes auth
  - external-secrets-token.yaml   # Token secret for ServiceAccount
  - clustersecretstore-operationtimecapsule.yaml  # External Secrets for operationtimecapsule (media/archives stuff like in song-of-storms, song-of-time)
  - clustersecretstore-pedestal-of-time.yaml  # External Secrets for pedestal-of-time (plex-ms-x and related apps)
  - clustersecretstore-precisionplanit.yaml  # External Secrets for PrecisionPlanIt secrets
  - clustersecretstore-zeldas-letter.yaml  # External Secrets for the Hyrule family (system/core apps)
  - clustersecretstore-great-sea.yaml  # External Secrets for great-sea (VPN-routed media automation apps in swift-sail)

patches:
  - path: vault-cr-patch.yaml
    target:
      kind: Vault
      name: vault
  - path: vault-sa-auth-delegator-patch.yaml
    target:
      kind: ClusterRoleBinding
      name: vault-tokenreview-binding
