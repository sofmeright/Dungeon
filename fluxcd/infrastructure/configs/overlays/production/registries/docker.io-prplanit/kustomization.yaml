apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: temple-of-time
resources:
  - ../../../../base/registries/docker.io-example
patches:
  - target:
      kind: ExternalSecret
      name: PLACEHOLDER_REGISTRY_NAME
    patch: |-
      - op: replace
        path: /metadata/name
        value: docker-io-prplanit-pull-secret
      - op: replace
        path: /spec/secretStoreRef/name
        value: vault-zeldas-letter
      - op: replace
        path: /spec/target/name
        value: docker-io-prplanit-pull-secret
      - op: replace
        path: /spec/target/template/data/.dockerconfigjson
        value: |
          {
            "auths": {
              "docker.io": {
                "auth": "{{ printf "%s:%s" .username .access_token | b64enc }}",
                "email": ""
              }
            }
          }
      - op: replace
        path: /spec/dataFrom/0/extract/key
        value: registries/docker.io
