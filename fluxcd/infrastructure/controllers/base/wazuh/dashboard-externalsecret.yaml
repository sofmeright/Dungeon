apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: wazuh-dashboard-secrets
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: PLACEHOLDER_SECRET_STORE
  target:
    name: wazuh-dashboard-secrets
    template:
      engineVersion: v2
      data:
        wazuh.yml: |
          hosts:
            - PLACEHOLDER_API_ID:
                url: "https://wazuh-manager"
                port: 55000
                username: {{ .API_USERNAME }}
                password: "{{ .API_PASSWORD }}"
                run_as: false
        opensearch_dashboards.yml: |
          server.host: 0.0.0.0
          server.port: 5601
          opensearch.hosts: https://wazuh-indexer:9200
          opensearch.username: "{{ .DASHBOARD_USERNAME }}"
          opensearch.password: "{{ .DASHBOARD_PASSWORD }}"
          opensearch.ssl.verificationMode: none
          opensearch.requestHeadersWhitelist: ["securitytenant","Authorization"]
          opensearch_security.multitenancy.enabled: false
          opensearch_security.readonly_mode.roles: ["kibana_read_only"]
          server.ssl.enabled: true
          server.ssl.key: "/usr/share/wazuh-dashboard/certs/wazuh-dashboard-key.pem"
          server.ssl.certificate: "/usr/share/wazuh-dashboard/certs/wazuh-dashboard.pem"
          opensearch.ssl.certificateAuthorities: ["/usr/share/wazuh-dashboard/certs/root-ca.pem"]
          uiSettings.overrides.defaultRoute: /app/wazuh
  dataFrom:
    - extract:
        key: PLACEHOLDER_VAULT_PATH
      rewrite:
        - regexp:
            source: "^dashboard-(.*)$"
            target: "$1"
