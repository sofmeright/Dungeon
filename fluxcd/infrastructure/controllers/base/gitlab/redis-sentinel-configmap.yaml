apiVersion: v1
kind: ConfigMap
metadata:
  name: gitlab-redis-sentinel-config
  labels:
    app: gitlab-redis
    component: sentinel
data:
  sentinel.conf: |
    # Redis Sentinel configuration for GitLab
    port 26379
    dir /data

    # Monitor the master - name it "gitlab-redis-master"
    # Initially monitor localhost since Sentinel runs as sidecar
    # Sentinels will auto-discover other instances via Pub/Sub
    sentinel monitor gitlab-redis-master 127.0.0.1 6379 2

    # Authentication
    sentinel auth-pass gitlab-redis-master PASSWORD_PLACEHOLDER

    # Timeouts and failover settings
    sentinel down-after-milliseconds gitlab-redis-master 5000
    sentinel parallel-syncs gitlab-redis-master 1
    sentinel failover-timeout gitlab-redis-master 10000

    # Logging
    loglevel notice
    logfile ""
