apiVersion: batch/v1
kind: Job
metadata:
  name: zitadel-login-v2-setup
  labels:
    app: zitadel
spec:
  ttlSecondsAfterFinished: 600
  template:
    metadata:
      labels:
        app: zitadel-login-v2-setup
    spec:
      serviceAccountName: zitadel
      restartPolicy: OnFailure
      containers:
      - name: setup
        image: ghcr.io/zitadel/zitadel:v4.3.0
        imagePullPolicy: IfNotPresent
        command:
        - /bin/sh
        - -c
        - |
          # This job needs to be run after Zitadel is up and configured
          # It will create a machine user with IAM_LOGIN_CLIENT role
          # and generate a PAT (Personal Access Token) for Login V2 to use

          echo "Login V2 setup job - Manual PAT creation required"
          echo "Please create a machine user via Zitadel console with IAM_LOGIN_CLIENT role"
          echo "and create a secret named zitadel-login-client with the PAT"
          exit 0
