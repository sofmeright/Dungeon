apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: prometheus
spec:
  targetNamespace: gossip-stone
  values:
    prometheus:
      prometheusSpec:
        storageSpec:
          volumeClaimTemplate:
            spec:
              storageClassName: ceph-rbd-retain
              resources:
                requests:
                  storage: 10Gi

        # Enable Thanos sidecar
        thanos:
          image: quay.io/thanos/thanos:v0.36.1
          version: v0.36.1
          objectStorageConfig:
            # Reference the thanos-objstore secret created by External Secrets
            name: thanos-objstore
            key: objstore.yml

      # Enable Thanos service for querying
      thanosService:
        enabled: true
        port: 10901
