apiVersion: v1
kind: Secret
metadata:
  name: rgw-admin-ops-user
type: Opaque
data:
  accessKey: ""
  secretKey: ""
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: secret-copier
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: secret-reader
  namespace: gorons-bracelet
rules:
- apiGroups: [""]
  resources: ["secrets"]
  resourceNames: ["rgw-admin-ops-user"]
  verbs: ["get"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: secret-copier-reader
  namespace: gorons-bracelet
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: secret-reader
subjects:
- kind: ServiceAccount
  name: secret-copier
  namespace: hyrule-castle
---
apiVersion: batch/v1
kind: Job
metadata:
  name: copy-rgw-admin-secret
spec:
  ttlSecondsAfterFinished: 60
  template:
    spec:
      serviceAccountName: secret-copier
      restartPolicy: Never
      containers:
      - name: kubectl
        image: docker.jcr.pcfae.com/bitnami/kubectl:latest
        command:
        - /bin/sh
        - -c
        - |
          kubectl get secret rgw-admin-ops-user -n gorons-bracelet -o json | \
            jq 'del(.metadata.namespace,.metadata.creationTimestamp,.metadata.resourceVersion,.metadata.uid)' | \
            kubectl apply -n hyrule-castle -f -
