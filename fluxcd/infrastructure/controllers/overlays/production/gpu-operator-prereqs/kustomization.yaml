apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: gorons-bracelet

resources:
- ../../../base/gpu-operator-prereqs

patches:
- target:
    kind: DaemonSet
    name: gpu-operator-prereqs
  patch: |-
    - op: add
      path: /spec/template/spec/nodeSelector
      value:
        nvidia.com/gpu.present: "true"
    - op: add
      path: /spec/template/spec/tolerations
      value:
      - key: nvidia.com/gpu
        operator: Exists
        effect: NoSchedule
    - op: replace
      path: /spec/template/spec/initContainers/0/image
      value: docker.io/busybox:latest
    - op: replace
      path: /spec/template/spec/containers/0/image
      value: registry.k8s.io/pause:3.10.1
