# Gitleaks configuration for secret scanning
# https://github.com/gitleaks/gitleaks

title = "Gitleaks Config for Dungeon K8s Cluster"

# Extend default gitleaks config
[extend]
useDefault = true

# Allowlist for false positives
[allowlist]
description = "Allowlisted files and patterns"

# Ignore specific paths that are known safe
paths = [
  '''\.md$''',
  '''docs/''',
  '''\.sops\.yaml$''',  # SOPS encrypted files
  '''\.enc\.yaml$''',   # SOPS encrypted files
]

# Ignore example/placeholder values and known safe patterns
regexes = [
  '''PLACEHOLDER_''',  # Template placeholder values
  '''example\.com''',  # Example domains
  '''changeme''',  # Placeholder passwords
  '''your-.*-here''',  # Placeholder strings
  '''0985467c-d8f3-4483-b27f-f0a512397ec2''',  # Ceph cluster FSID (public identifier)
  '''a3ViZXJuZXRlcw==''',  # Example Kubernetes token
  '''age1[a-z0-9]{58}''',  # SOPS age public keys (safe to commit)
]

# ExternalSecret templates contain kubernetes.io/tls type references and
# Go template expressions ({{ .cert }}) that trigger kubernetes-secret-yaml
# rule â€” these are ESO templates, not actual Secret manifests.
[[rules]]
id = "kubernetes-secret-yaml"
description = "Allow ExternalSecret templates referencing TLS types"
[rules.allowlist]
paths = [
  '''externalsecret.*\.yaml$''',
]
