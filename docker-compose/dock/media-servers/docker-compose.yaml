---
services:

  calibre-web:
    container_name: calibre-web
    environment:
      - TZ=Etc/UTC
      - PUID=8083
      - PGID=1000
      #- DOCKER_MODS=linuxserver/mods:universal-calibre #optional
      #- OAUTHLIB_RELAX_TOKEN_SCOPE=1 #optional
    image: lscr.io/linuxserver/calibre-web:latest
    ports:
      - 8083:8083
    restart: always
    volumes:
      - /opt/docker/calibre-web/config:/config
      - media_books:/books
    logging: &logging
      driver: "loki"
      options:
        loki-batch-size: "400"
        loki-url: "http://monitoring:3100/loki/api/v1/push"
        max-size: "10m"
        max-file: "3"
        mode: "non-blocking"
        loki-retries: "2"
        loki-max-backoff: "800ms"
        loki-timeout: "1s"

volumes:
  media_books:
    driver: local
    driver_opts:
      type: cifs
      o: "iocharset=utf8,username=$SAMBA_BOOKS_USER,password=$SAMBA_BOOKS_PASS,uid=8083,nobrl,rw,vers=2.1,file_mode=0777,dir_mode=0777"
      device: "//gringotts/media_books"